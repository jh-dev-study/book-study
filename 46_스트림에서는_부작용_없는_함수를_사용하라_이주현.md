## Item 46 스트림에서는 부작용 없는 함수를 사용하라
  - 스트림 패러다임의 핵심은 계산을 일련의 변환으로 재구성하는 부분
  - 이때, 각 변환 단계는 가능한 한 이전 단계의 결과를 받아 처리하는 **순수 함수** 여야 함
    - 순수 함수란, 오직 입력만이 결과에 영향을 주는 함수
    - 다른 가변 상태를 참조하지 않고, 함수 스스로도 다른 상태를 변경하지 않는다.
    - 스트림 연산에 건네는 함수 객체는 모두 부작용(side effect)가 없어야 함
    - **forEach 연산은 스트림 계산 결과를 보고할 때만 사용하고, 계산하는 데는 쓰지 말자.**
    
```java

// 문제 코드
Map<String, Long> freq = new HashMap<>();

try (Stream<String> words = new Scanner(file).tokens()) {
    words.forEach(word -> {
        freq.merge(word.toLowerCase(), 1L. Long::sum);
    });
}

// 정상 코드
Map<String, Long> freq = new HashMap<>();

try (Stream<String> words = new Scanner(file).tokens()) {
    freq = words.collect(groupingBy(String::toLowerCase, counting()));
}
```

<br>

### Collectors 클래스(수집기)는 스트림을 사용하려면 꼭 배워야 하는 새로운 개념
  - 수집기가 생성하는 객체는 일반적으로 컬렉션, 따라서 collector"라는 이름을 씀
  - 수집기를 사용하면 스트림의 원소를 손쉽게 컬렉션으로 모을 수 있음
  - toList(), toSet(), toCollection(), toMap() 등이 있다.
  
  
```java
// 빈도표에서 가장 흔한 단어 10개를 뽑아내는 예제
Map<String, Long> freq = new HashMap<>();

List<String> topTen = freq.keySet()
    .stream()
    .sorted(Comparator.comparing(freq::get).reversed())
    .limit(10)
    .collect(Collectors.toList());
```

<br>

### toList(), toSet(), toCollection(), toMap()
  - toList()
    - 모든 Stream의 요소를 List 인스턴스로 수집
    - 특정 List를 구현하는 것이 아님
    
  - toSet()
    - 모든 Stream의 요소를 Set 인스턴스로 수집
    - Set: 중복 X
  
  - toCollection()
    - toList(), toSet() 등은 특정 List, Set의 구현체를 지정할 수 없는데, toCollection을 사용하면 Collection(List, Set 등)의 구현이 가능
    
  - toMap()
    - 모든 Stream의 요소를 Map 인스턴스로 수집
    - 두 기능을 제공
      - keyMapper: Stream 요소에서 Map의 Key를 추출하는 데 사용
      - valueMapper: Key와 관련된 Value의 값을 추출

```java
import java.util.*;
import java.util.function.Function;
import java.util.stream.Collectors;

public class StreamEx {

    public static void main(String[] args) {
        List<String> list = new ArrayList<>(Arrays.asList("a", "bb", "a", "ccc", "dddd"));

        // toList()
        List<String> resultList = list.stream().collect(Collectors.toList());
        for (String s : resultList) {
            System.out.print(s + " ");  // a, bb, a, ccc, dddd
        }

        System.out.println();

        // toSet()
        Set<String> resultSet = list.stream().collect(Collectors.toSet());
        for (String s : resultSet) {
            System.out.print(s + " ");  // bb, a, ccc, dddd
        }

        System.out.println();

        // toCollection()
        List<String> lists = list.stream().collect(Collectors.toCollection(LinkedList::new));
        for (String s : lists) {
            System.out.print(s + " ");  // a bb a ccc dddd
        }

        System.out.println();

        Set<String> sets = list.stream().collect(Collectors.toCollection(HashSet::new));
        for (String set : sets) {
            System.out.print(set + " ");    // bb a ccc dddd
        }

        System.out.println();


        // toMap()
        Map<String, Integer> resultMap = list.stream().collect(Collectors.toMap(Function.identity(), String::length));
        for (String s : resultMap.keySet()) {
            System.out.println(s + " ");
        }

        System.out.println();
    }
}

```
